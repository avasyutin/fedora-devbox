- name: check mysql installed
  command: test -x /usr/bin/mysql
  register: mysql_installed
  ignore_errors: yes
- name: dnf | install
  dnf: name={{item}} state=latest
  with_items:
    - mariadb
    - mariadb-server
    - mariadb-devel
    - MySQL-python
  when: mysql_installed|failed
- name: copy config
  copy: src=mariadb-server.cnf dest=/etc/my.cnf.d/mariadb-server.cnf owner=mysql group=mysql
  when: mysql_installed|failed
- name: restart service
  service: name=mariadb state=restarted
  when: mysql_installed|failed
- name: update root password
  mysql_user: login_user=root login_password="" name=root host=localhost password=root priv=*.*:ALL,GRANT
  when: mysql_installed|failed
- name: remove test datbase
  mysql_db: login_user=root login_password=root db=test state=absent
  when: mysql_installed|failed
- name: restart mysql
  service: name=mariadb state=restarted enabled=yes
  when: mysql_installed|failed
- name: copy client config
  copy: src=client-my.cnf dest=/home/{{dev_user}}/.my.cnf owner={{dev_user}} group={{dev_user}} force=no
